pipeline {
  agent [dockerslave]
   stages {
      stage('Clone Sources') {
        steps {
          checkout scm
        } 
      }
      stage('check if image exist and install if not') {
         steps {
            echo 'check if image exist and install if not'  
		 sh''' if [ $(docker images | grep alpcon | wc -l) -eq 0 ]; then
                docker build -t alpcon:1.0 .
                fi
		  '''
         }
      }
       stage('run the file') {
         steps {
            echo 'running file'  
		 sh'''if [ $(docker ps | grep alpcon | wc -l) -eq 0 ]; then
                if [ $(docker ps -a | grep alpcon | wc -l) -eq 0 ]; then
                    docker run -v ${WORKSPACE}:/home/app/ --name alpcon alpcon:1.0
                fi
		docker start alpcon
              fi
		  '''
         }
      }
      
       stage('stop and check exit code') {
         steps {
            echo 'stopping checking exit code'  
		 sh'''docker stop alpcon
              if [ $(docker ps -a | grep alpcon | grep "Exited (0)" | wc -l ) -eq 0 ]; then
                "filed to execute file" >> logfile
              fi
		  '''
         }
      }
      
      
   }
}
